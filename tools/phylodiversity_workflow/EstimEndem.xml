<tool id="EstimEndem" name="Estimate the endemism of each cell of a spatial grid" version="0.1.0+galaxy0" python_template_version="3.5" profile="21.05">
    <description>
        Tool to estimate the endemism of each cell of a spatial grid using the R script EstimEndem.R.
    </description>

    <macros>
        <token name="@TOOL_VERSION@">1.0</token> 
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    
    <requirements>
        <requirement type="package" version="4.3.3">r-base</requirement> 
        <requirement type="package" version="1.0.8">r-phyloregion</requirement>
        <requirement type="package" version="1.6.5">r-matrix</requirement>
        <requirement type="package" version="5.8_1">r-ape</requirement>
        <requirement type="package" version="1.2.2">bioconductor-sparsearray</requirement>
        <requirement type="package" version="1.0_20">r-sf</requirement>
        <requirement type="package" version="2.2_0">r-sp</requirement>
        <requirement type="package" version="3.6_32">r-raster</requirement>
        <requirement type="package" version="1.1.4">r-dplyr</requirement> 
    </requirements>

    <command detect_errors="exit_code">
        <![CDATA[
        mkdir '$shapefile.extra_files_path' &&
        Rscript '$__tool_directory__/EstimEndem.R'
            '$phylogeny'  
            '$occupancy'
            ${os.path.join( $coordinates_file_input.extra_files_path, "shapefile.shp" )} 
            '$nb_cluster'
            '$clustering_method'
            
        &&
        mv output.* ${shapefile.extra_files_path}

        ]]>
    </command>

    <inputs>
        <param name="phylogeny" type="data" format="newick" label="Phylogeny file (Newick format)" />
        <param name="occupancy" type="data" format="tabular" label="Occupancy data (Tabular format)" />
        <param name ="coordinates_file_input" type="data" format="shp" label="input_shapefile" help="Provide coordinates files"/>
        <param name="nb_cluster" type="integer" value="10" label="the number of cluster" help="choose the number pf pjyloregion"/>
        <param name ="clustering_method" type="select" checked="true" 
               label="Choose a clustering method" help="choose">
            <option value="ward.D" selected="true">ward.D</option>
            <option value="ward.D2">ward.D2</option>
            <option value="single">single</option>
            <option value="complete">complete</option>
            <option value="average">UPGMA</option>
            <option value="mcquitty">WPGMA</option>
            <option value="median">WPGMC</option>
            <option value="centroid">UPGMC</option>
        </param>

    </inputs>
    <outputs>
        <data name="shapefile" format="shp" label="shapefile"/>
    </outputs>

    <tests>
        <test>
            <param name="phylogeny" value="tree_file"/>
            <param name="occupancy" value="matrix_file"/>
            <param name="coordinates_file_input" value="composite_dataset/shapefile" ftype="shp">
                <composite_data value="composite_dataset/shapefile.shp"/>
                <composite_data value="composite_dataset/shapefile.shx"/>
                <composite_data value="composite_dataset/shapefile.dbf"/>
                <composite_data value="composite_dataset/shapefile.prj"/>
            </param>
            <param name="nb_cluster" value="8"/>
            <param name="clustering_method" value="UPGMA"/>

            <output file="shapefile/shapefile_shp.html" name="shapefile">
                <extra_files type="file" name="output.shp" value="shapefile/output.shp"/>
                <extra_files type="file" name="output.shx" value="shapefile/output.shx"/>
                <extra_files type="file" name="output.dbf" value="shapefile/output.dbf" compare="sim_size" delta="50"/>
                <extra_files type="file" name="output.prj" value="shapefile/output.prj"/>
            </output>
        </test>
    </tests>

    <help>
        <![CDATA[
            This tool estimates the endemism of each cell in a spatial grid using the provided phylogeny, occupancy data, and spatial coordinates. 
            Ensure that the input files are in the correct formats: Newick for phylogeny, tabular for occupancy, and shapefile for spatial data.

        ]]>
    </help>       
    
    <citations>
        <citation type="bibtex">@Manual{, 
            }        
        </citation>
    </citations>
    
</tool>