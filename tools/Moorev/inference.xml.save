<tool id="moover_inference" name="Moover-inference" version="1.0.0">
  <description> Automated tracking, segmentation and feature extraction </description>
  <requirements>
    <requirement type="package" version="8.1.2">ultralytics</requirement>
    <requirement type="package" version="2.1.2+cu121">torch</requirement>
    <requirement type="package" version="1.24.4">numpy</requirement>
    <requirement type="package" version="4.9.0">cv2</requirement>
    <requirement type="package" version="1.0">csv</requirement>
    <requirement type="package" version="1.1">argparse</requirement>
    <requirement type="package" version="6.0.1">yaml</requirement>
  </requirements>
  <command> 
    <![CDATA[
    mkdir results  
    && python '${__tool_directory__}/inference/main.py' '$input_file' 
    #if $Imnfernce_model_selection.default_or_custom=="default"
    'default' 
    #else 
    '$model_wights' 
    #end if
    '$conf' '${__tool_directory__}' '$save_csv' '$save_prediction' '$save_annotation'
    && rm -r results
    ]]>
  </command>
  <inputs>
    <param format="mp4" name="input_file" type="data" label="Input video"/>
    <conditional name="Imnfernce_model_selection">
      <param name="default_or_custom" type="select" label="Use the default model or a custom model">
        <option value="default">default</option>
        <option value="custom">custom</option>
      </param>
      <when value="default"/>
      <when value="custom">
        <param format="pt" name="model_wights" type="data" label="model_wights"/>
      </when>
    </conditional>
    <param name="conf" value="50.0" type="float" min="0" max="100" label="Percentage" help="Between 0 and 100, e.g. 50%"/>
    <param name="save_prediction" type="boolean" label="save predictions ?"/>
    <param name="save_csv" type="boolean" label="extract info ?"/>
    <param name="save_annotation" type="boolean" label="save annotation ?"/>
  </inputs>
  <outputs>
    <data format="zip" name="output_file" from_work_dir="results.zip"/>
  </outputs>
  <tests>
    <test>
      <!-- -->
    </test>
  </tests>
  <help>
  Moover Inference Tool
  

  This tool performs automated tracking, segmentation, and feature extraction on input videos. It utilizes the Moover-inference library to accomplish these tasks.
  

  **Inputs:**
  
  - **Input video:** Provide the video file on which the analysis will be performed.

  - **Use the default model or a custom model:** Select whether to use the default model or provide a custom one.
  
  - **Model weights:** If custom model is selected, upload the model weights file here.
  
  - **Percentage:** Set the confidence threshold percentage between 0 and 100 for the analysis.
  
  - **Save predictions?:** Choose whether to save the predictions generated by the tool.
  
  - **Extract info?:** Choose whether to extract additional information.
  
  - **Save annotation?:** Choose whether to save annotations.
  

  **Outputs:**
  - **Output file:** The results of the analysis will be provided as a zip file containing various outputs.
</help>
  <citations>
    <citation type="bibtex"> 
      @misc{ moover_inference,
       author = "e4",
       title = "Automated tracking, segmentation and feature extraction",
       year = "2024" } 
    </citation>
  </citations>
</tool>
